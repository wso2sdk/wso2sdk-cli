import org.apache.tools.ant.filters.ReplaceTokens

buildscript {
    repositories {
        jcenter();
    }
}

apply plugin: 'groovy'

dependencies {
    compile 'org.codehaus.groovy:groovy:2.4.7'
}

def userHome = System.getProperty("user.home");
ext.wso2sdkDir = "${userHome}/wso2sdk"

task cleanModules(type: Delete) {
    delete "${wso2sdkDir}"
}

clean.dependsOn cleanModules

task prepareScripts(type: Copy, dependsOn: clean) {
    from "src/main/bash"
    into "build/bin"
    include "**/*"
    filter(ReplaceTokens, tokens:
            [
                    WSO2SDK_VERSION     : "1.0-SNAPSHOT",
                    WSO2SDK_PRODUCTS_API: "get.wso2sdk.io"
            ]
    )
}

task installModules(type: Copy, dependsOn: [prepareScripts]) {
    from "build/bin"
    into "${wso2sdkDir}/bin"
    include "**/*"

    println "${wso2sdkDir}/bin"
}